<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Moje Filmy â€” WybÃ³r profilu</title>

<style>
:root{
  --bg1:#040405; --bg2:#0b0c10; --muted:#9aa3b2;
  --accent:#8b5cf6; --accent-2:#7c3aed;
  --text:#eef2f6;
  --radius:14px; --ease:cubic-bezier(.2,.9,.3,1);
}
*{box-sizing:border-box}
body{
  margin:0;
  background:radial-gradient(1000px at 10% 10%,rgba(120,70,255,0.08),transparent),
             linear-gradient(180deg,var(--bg1),var(--bg2));
  font-family:Inter,system-ui,Arial;
  color:var(--text);
}

/* HEADER */
.header{
  display:flex;align-items:center;justify-content:space-between;
  padding:20px 24px;
  border-bottom:1px solid rgba(255,255,255,0.05);
}
.logo{
  width:60px;height:60px;border-radius:14px;
  background:linear-gradient(135deg,var(--accent),var(--accent-2));
  display:flex;align-items:center;justify-content:center;
  font-size:22px;font-weight:800;
  box-shadow:0 15px 45px rgba(0,0,0,0.6);
}
.title{font-size:22px;font-weight:700;margin:0;margin-left:18px}
.subtitle{font-size:14px;color:var(--muted);margin-left:18px;margin-top:4px}

.container{
  max-width:1100px;margin:0 auto;padding:24px;
}

#profiles{
  margin-top:30px;
  display:flex;flex-wrap:wrap;gap:22px;
}

.profile-card{
  width:160px;cursor:pointer;text-align:center;
  transition:transform .25s var(--ease);
}
.profile-card:hover{transform:translateY(-10px)}

.avatar{
  width:140px;height:140px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:60px;
  background:rgba(255,255,255,0.03);
  border:6px solid rgba(255,255,255,0.05);
  box-shadow:0 12px 40px rgba(0,0,0,0.6);
  margin:0 auto;
}
.add-avatar{
  border:4px dashed rgba(255,255,255,0.06);
  background:rgba(255,255,255,0.02);
  font-size:70px;color:var(--muted);
}

.pname{margin-top:10px;font-size:17px;font-weight:700}
.psub{font-size:13px;color:var(--muted)}

footer{
  margin-top:25px;color:var(--muted);font-size:14px;text-align:center;
}

/* MODAL */
.modal-bg{
  position:fixed;inset:0;
  background:rgba(0,0,0,0.6);
  display:none;align-items:center;justify-content:center;
  z-index:1000;
}
.modal{
  width:100%;max-width:800px;
  background:linear-gradient(180deg,#11151c,#090d12);
  padding:24px;border-radius:14px;
  animation:pop .4s var(--ease);
  border:1px solid rgba(255,255,255,0.05);
}
@keyframes pop{
  0%{transform:scale(.96);opacity:0}
  100%{transform:scale(1);opacity:1}
}

.modal-grid{
  display:grid;grid-template-columns:1fr 280px;gap:20px;
}
.input{
  width:100%;padding:12px;border-radius:10px;
  background:rgba(255,255,255,0.03);
  border:1px solid rgba(255,255,255,0.07);
  color:var(--text);font-size:15px;
  margin-top:10px;
}

/* Icons / Colors */
.icon-list,.color-list{
  display:flex;flex-wrap:wrap;gap:8px;margin-top:10px;
}
.icon-opt{
  width:48px;height:48px;border-radius:12px;
  display:flex;align-items:center;justify-content:center;
  background:rgba(255,255,255,0.04);
  cursor:pointer;font-size:22px;
}
.icon-opt.selected{
  outline:3px solid rgba(255,255,255,0.1);
  transform:translateY(-6px);
}

.color-opt{
  width:36px;height:36px;border-radius:8px;cursor:pointer;
}
.color-opt.selected{
  outline:3px solid rgba(255,255,255,0.15);
  transform:translateY(-6px);
}

/* Avatar preview */
.preview{
  width:220px;height:220px;border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:80px;margin:auto;
  background:rgba(255,255,255,0.05);
  border:6px solid rgba(255,255,255,0.07);
}
</style>
</head>
<body>

<!-- HEADER -->
<div class="header">
  <div style="display:flex;align-items:center">
    <div class="logo">MF</div>
    <div>
      <div class="title">Wybierz profil</div>
      <div class="subtitle">Profile zapisane w Firestore</div>
    </div>
  </div>
</div>

<div class="container">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <h2>Twoje profile</h2>
    <button id="btnAdd" style="padding:10px 16px;border:none;border-radius:10px;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white;cursor:pointer;font-size:15px">Dodaj profil</button>
  </div>

  <div id="profiles"></div>

  <footer>Kliknij profil, aby przejÅ›Ä‡ dalej. JeÅ›li ma hasÅ‚o â€” wpiszesz je.</footer>
</div>

<!-- MODAL -->
<div id="modalBg" class="modal-bg">
  <div class="modal">
    <h2 id="modalTitle">Nowy profil</h2>

    <div class="modal-grid">
      <div>
        <input id="nameInput" class="input" placeholder="Nazwa profilu">
        <input id="passInput" class="input" placeholder="HasÅ‚o (opcjonalne)">
        <div style="margin-top:14px;color:var(--muted)">Kolor motywu</div>
        <div id="colorList" class="color-list"></div>

        <div style="display:flex;gap:10px;margin-top:20px">
          <button id="cancelBtn" class="input" style="background:rgba(255,255,255,0.04)">Anuluj</button>
          <button id="saveBtn" class="input" style="background:linear-gradient(90deg,var(--accent),var(--accent-2));border:none">Zapisz</button>
        </div>
      </div>

      <div>
        <div class="preview" id="previewEmoji">ðŸ™‚</div>
        <div style="margin-top:12px;color:var(--muted);text-align:center">Ikonka</div>
        <div id="iconList" class="icon-list"></div>
      </div>

    </div>

  </div>
</div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

<script>
/* ---------------- FIREBASE CONFIG ---------------- */
const firebaseConfig = {
  apiKey: "AIzaSyB7lLkah3C6y76fZFWrnnVwIDEqsdi3BN0",
  authDomain: "filmy-a8f12.firebaseapp.com",
  projectId: "filmy-a8f12",
  storageBucket: "filmy-a8f12.appspot.com",
  messagingSenderId: "641694983734",
  appId: "1:641694983734:web:ab4a930bb892ce1e7c2bf7"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ------------------ STATE ------------------ */
const ICONS = ["ðŸŽ¬","â­","ðŸ”¥","ðŸ“º","ðŸŽ®","ðŸŽ§","ðŸŽ­","ðŸ§©","ðŸš€","ðŸ‰","ðŸ¿","ðŸŽ¯","ðŸ‘‘","ðŸ¦Š","ðŸ¼","ðŸ•¶ï¸"];
const COLORS = ["#e50914","#0d6efd","#198754","#ffc107","#ff5ea0","#20c997","#6f42c1","#fd7e14","#0dcaf0","#6610f2","#ff7f50","#2ecc71"];

let profiles = [];
let editId = null;
let selectedColor = COLORS[0];
let selectedIcon = ICONS[0];

/* ------------------ UI ELEMENTS ------------------ */
const profilesEl = document.getElementById("profiles");
const modalBg = document.getElementById("modalBg");
const modalTitle = document.getElementById("modalTitle");
const nameInput = document.getElementById("nameInput");
const passInput = document.getElementById("passInput");
const iconList = document.getElementById("iconList");
const colorList = document.getElementById("colorList");
const previewEmoji = document.getElementById("previewEmoji");

/* ------------------ LOAD PROFILES ------------------ */
db.collection("profiles").orderBy("createdAt", "asc").onSnapshot(snap => {
  profiles = snap.docs.map(d => ({ id: d.id, ...d.data() }));
  renderProfiles();
});

/* ------------------ RENDER PROFILES ------------------ */
function renderProfiles(){
  profilesEl.innerHTML = "";

  profiles.forEach(p => {
    const div = document.createElement("div");
    div.className = "profile-card";
    div.innerHTML = `
      <div class="avatar" style="background:${p.color}">${p.icon}</div>
      <div class="pname">${p.name}</div>
      <div class="psub">${p.pass ? "z hasÅ‚em" : ""}</div>
    `;
    div.onclick = () => openProfile(p);
    profilesEl.appendChild(div);
  });

  // ADD NEW CARD
  const add = document.createElement("div");
  add.className = "profile-card";
  add.innerHTML = `
      <div class="avatar add-avatar">+</div>
      <div class="pname">Dodaj profil</div>
  `;
  add.onclick = openAdd;
  profilesEl.appendChild(add);
}

/* ------------------ OPEN PROFILE ------------------ */
function openProfile(p){
  if (p.pass){
    const pw = prompt(`Wpisz hasÅ‚o dla ${p.name}:`);
    if (pw !== p.pass) return alert("BÅ‚Ä™dne hasÅ‚o!");
  }
  localStorage.setItem("currentProfile", p.id);
  location.href = "app.html";
}

/* ------------------ ADD / EDIT ------------------ */
document.getElementById("btnAdd").onclick = openAdd;

function openAdd(){
  editId = null;
  modalTitle.textContent = "Nowy profil";
  nameInput.value = "";
  passInput.value = "";
  selectedColor = COLORS[0];
  selectedIcon = ICONS[0];
  renderSelectors();
  modalBg.style.display = "flex";
}

document.getElementById("cancelBtn").onclick = () => {
  modalBg.style.display = "none";
};

document.getElementById("saveBtn").onclick = async () => {
  const name = nameInput.value.trim();
  if (!name) return alert("Podaj nazwÄ™ profilu!");

  const data = {
    name,
    pass: passInput.value || "",
    icon: selectedIcon,
    color: selectedColor,
    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
  };

  if (editId){
    await db.collection("profiles").doc(editId).set(data, { merge:true });
  } else {
    data.createdAt = firebase.firestore.FieldValue.serverTimestamp();
    await db.collection("profiles").add(data);
  }

  modalBg.style.display = "none";
};

/* ------------------ ICONS & COLORS ------------------ */
function renderSelectors(){
  previewEmoji.textContent = selectedIcon;
  previewEmoji.style.background = selectedColor;

  iconList.innerHTML = "";
  ICONS.forEach(ic => {
    const el = document.createElement("div");
    el.className = "icon-opt";
    if (ic === selectedIcon) el.classList.add("selected");
    el.textContent = ic;
    el.onclick = () => { selectedIcon = ic; renderSelectors(); };
    iconList.appendChild(el);
  });

  colorList.innerHTML = "";
  COLORS.forEach(c => {
    const el = document.createElement("div");
    el.className = "color-opt";
    el.style.background = c;
    if (c === selectedColor) el.classList.add("selected");
    el.onclick = () => { selectedColor = c; renderSelectors(); };
    colorList.appendChild(el);
  });
}
</script>

</body>
</html>
