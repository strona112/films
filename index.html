<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Wyb√≥r profilu ‚Äî Moje Filmy</title>
<style>
:root{
  --bg1:#040405; --bg2:#0b0c10; --muted:#9aa3b2;
  --accent:#8b5cf6; --accent-2:#7c3aed;
  --card: rgba(255,255,255,0.03);
  --radius:14px; --ease:cubic-bezier(.2,.9,.3,1);
  --text:#eef2f6;
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,system-ui,Arial;background:
  radial-gradient(1200px 600px at 10% 10%, rgba(140,80,255,0.03), transparent 6%),
  linear-gradient(180deg,var(--bg1),var(--bg2));color:var(--text);-webkit-font-smoothing:antialiased;}
a{color:inherit}

/* top header */
.header{display:flex;align-items:center;justify-content:space-between;padding:18px 24px;border-bottom:1px solid rgba(255,255,255,0.02)}
.brand{display:flex;align-items:center;gap:14px}
.logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;font-weight:800;font-size:20px;box-shadow:0 12px 40px rgba(0,0,0,0.6)}
.title{font-size:20px;margin:0}
.subtitle{font-size:13px;color:var(--muted)}

/* main container */
.container{max-width:1100px;margin:28px auto;padding:0 18px}
.hint{color:var(--muted);margin-top:6px}

/* profiles grid */
#profiles{display:flex;gap:20px;flex-wrap:wrap;margin-top:28px}
.profile-card{width:160px;text-align:center;cursor:pointer;transition:transform .28s var(--ease);display:flex;flex-direction:column;align-items:center}
.profile-card:hover{transform:translateY(-10px)}
.avatar{width:140px;height:140px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:56px;background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(0,0,0,0.06));border:6px solid rgba(255,255,255,0.03);box-shadow:0 18px 60px rgba(0,0,0,0.6);overflow:hidden}
.add-avatar{display:flex;align-items:center;justify-content:center;font-size:72px;color:var(--muted);background:linear-gradient(135deg,#111,#222);border:4px dashed rgba(255,255,255,0.03)}
.pname{margin-top:10px;font-weight:700}
.psub{font-size:13px;color:var(--muted)}

/* modal */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:80}
.modal{width:100%;max-width:820px;background:linear-gradient(180deg,#0d1117,#071019);border-radius:14px;padding:16px;border:1px solid rgba(255,255,255,0.03);box-shadow:0 30px 90px rgba(2,6,23,0.9)}
.form{display:grid;grid-template-columns:1fr 360px;gap:14px}
.input, textarea, select{width:100%;background:transparent;border:1px solid rgba(255,255,255,0.04);padding:10px;border-radius:10px;color:var(--text)}
textarea{min-height:120px;resize:vertical}

/* avatar chooser */
.avatar-chooser{display:flex;flex-direction:column;align-items:center;gap:12px}
.preview{width:260px;height:260px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:82px;border:6px solid rgba(255,255,255,0.03);overflow:hidden;position:relative;background:linear-gradient(135deg, rgba(255,255,255,0.02), rgba(0,0,0,0.05))}
.preview .ring{position:absolute;inset:0;border-radius:50%;box-shadow:0 18px 60px rgba(0,0,0,0.5) inset}
.arrow-wrap{display:flex;align-items:center;gap:12px}
.arrow{width:56px;height:56px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.02);cursor:pointer;border:1px solid rgba(255,255,255,0.03);font-size:20px}
.icon-list{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-top:8px}
.icon-option{width:52px;height:52px;border-radius:12px;display:flex;align-items:center;justify-content:center;background:rgba(255,255,255,0.02);cursor:pointer;font-size:22px}
.icon-option.selected{outline:3px solid rgba(255,255,255,0.06);transform:translateY(-6px)}

/* colors */
.color-grid{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.color-box{width:36px;height:36px;border-radius:8px;cursor:pointer;border:2px solid transparent}
.color-box.selected{outline:3px solid rgba(255,255,255,0.06);transform:translateY(-6px)}

/* footer */
.footer{margin-top:18px;color:var(--muted);font-size:13px;text-align:center}

/* small animations */
@keyframes popIn{0%{transform:scale(.96);opacity:0}60%{transform:scale(1.03);opacity:1}100%{transform:scale(1);opacity:1}}
.preview{animation:popIn 560ms var(--ease) both}

/* responsive */
@media (max-width:900px){
  .form{grid-template-columns:1fr}
  .preview{width:200px;height:200px;font-size:64px}
  .avatar{width:120px;height:120px;font-size:44px}
}
</style>
</head>
<body>

<!-- HEADER -->
<div class="header">
  <div class="brand">
    <div class="logo">MF</div>
    <div>
      <div class="title">Wybierz profil</div>
      <div class="subtitle">Szybkie logowanie ‚Äî profile globalne (Firestore)</div>
    </div>
  </div>
  <div style="text-align:right;color:var(--muted)">Gotowe do GitHub Pages</div>
</div>

<main class="container">
  <div style="display:flex;justify-content:space-between;align-items:center">
    <div>
      <h2 style="margin:0">Twoje profile</h2>
      <div class="hint">Dodaj maksymalnie 7 profili ‚Äî ka≈ºdy bƒôdzie widoczny dla wszystkich (telefon/komputer).</div>
    </div>
    <div>
      <button id="btnAdd" style="padding:10px 12px;border-radius:10px;background:linear-gradient(90deg,var(--accent),var(--accent-2));border:none;color:white;cursor:pointer">Dodaj konto</button>
    </div>
  </div>

  <div id="profiles" aria-live="polite"></div>

  <div class="footer">Kliknij profil, aby przej≈õƒá dalej do aplikacji. Je≈õli profil ma has≈Ço ‚Äî zostaniesz poproszony o jego podanie.</div>
</main>

<!-- CREATE/EDIT MODAL -->
<div id="profileModal" class="modal-bg" style="display:none">
  <div class="modal" role="dialog" aria-modal="true">
    <h2 id="modalTitle">Dodaj konto</h2>
    <div class="form">
      <div>
        <input id="profileName" class="input" placeholder="Nazwa konta (np. Adrian)" maxlength="24">
        <input id="profilePass" class="input" placeholder="Has≈Ço (opcjonalnie)" style="margin-top:10px">
        <div style="margin-top:8px;font-size:13px;color:var(--muted)">Kolor motywu</div>
        <div id="colorGrid" class="color-grid"></div>

        <div style="margin-top:12px;font-size:13px;color:var(--muted)">Status profili: <span id="profilesInfo"></span></div>

        <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:14px">
          <button id="cancelBtn" class="input" style="background:transparent;border:1px solid rgba(255,255,255,0.04);cursor:pointer">Anuluj</button>
          <button id="saveBtn" class="input" style="background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white;border:none;cursor:pointer">Zapisz</button>
        </div>

      </div>

      <div class="avatar-chooser">
        <!-- using a sample uploaded file as decorative background -->
        <div class="preview" id="avatarPreview">
          <div class="ring"></div>
          <div id="avatarEmoji">üôÇ</div>
        </div>

        <div class="arrow-wrap">
          <div class="arrow" id="prevIcon">‚óÄ</div>
          <div style="color:var(--muted);font-size:13px">Wybierz ikonkƒô</div>
          <div class="arrow" id="nextIcon">‚ñ∂</div>
        </div>

        <div id="iconList" class="icon-list"></div>

        <!-- decorative sample image you uploaded (local path) -->
        <div style="margin-top:8px;color:var(--muted);font-size:12px">Sample:</div>
        <img src="/mnt/data/8729db91-fe45-4814-80f0-38d6de412636.png" alt="sample" style="width:120px;height:60px;border-radius:8px;object-fit:cover;border:2px solid rgba(255,255,255,0.03)">

      </div>
    </div>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script>
/* ================= FIREBASE CONFIG =================
   Wklej swojƒÖ konfiguracjƒô z konsoli Firebase tutaj
   (mo≈ºesz pozostawiƒá tƒô przyk≈ÇadowƒÖ, je≈õli to Tw√≥j projekt)
*/
const firebaseConfig = {
  apiKey: "AIzaSyB7lLkah3C6y76fZFWrnnVwIDEqsdi3BN0",
  authDomain: "filmy-a8f12.firebaseapp.com",
  projectId: "filmy-a8f12",
  storageBucket: "filmy-a8f12.appspot.com",
  messagingSenderId: "641694983734",
  appId: "1:641694983734:web:ab4a930bb892ce1e7c2bf7",
  measurementId: "G-XNV7QG88QX"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ===================== STATE ===================== */
const ICONS = ["üé¨","‚≠ê","üî•","üéÆ","üì∫","üéß","üé≠","üß©","üöÄ","üêâ","üçø","üéØ","üï∂Ô∏è","üëë","üìΩÔ∏è"];
const COLORS = ["#e50914","#0d6efd","#198754","#ffc107","#d63384","#20c997","#6f42c1","#fd7e14","#0dcaf0","#6610f2","#ff7f50","#2ecc71"];

let profiles = []; // loaded from Firestore
let editingDocId = null; // if editing existing profile
const MAX_PROFILES = 7;

/* UI refs */
const profilesEl = document.getElementById('profiles');
const profileModal = document.getElementById('profileModal');
const avatarEmoji = document.getElementById('avatarEmoji');
const iconList = document.getElementById('iconList');
const colorGrid = document.getElementById('colorGrid');
const avatarPreview = document.getElementById('avatarPreview');
const profilesInfo = document.getElementById('profilesInfo');

let selectedIconIndex = 0;
let selectedColor = COLORS[0];

/* ---------- realtime listeners ---------- */
function startRealtime(){
  db.collection('profiles').orderBy('createdAt','asc').onSnapshot(snap => {
    const arr = [];
    snap.forEach(doc => {
      const d = doc.data(); d.id = doc.id;
      arr.push(d);
    });
    profiles = arr;
    renderProfiles();
    updateProfilesInfo();
    // if too many profiles exist, nothing else (UI prevents adding)
  }, err => {
    console.error('Firestore profiles error', err);
    alert('B≈ÇƒÖd pobierania profili: ' + err.message);
  });
}

/* render profiles grid */
function renderProfiles(){
  profilesEl.innerHTML = '';
  profiles.forEach(p => {
    const card = document.createElement('div'); card.className = 'profile-card';
    card.onclick = () => selectProfile(p);
    const av = document.createElement('div'); av.className = 'avatar';
    av.style.background = p.color ? `linear-gradient(135deg, ${p.color}, ${shadeColor(p.color, -10)})` : 'linear-gradient(135deg,var(--accent),var(--accent-2))';
    av.textContent = p.icon || 'üôÇ';
    const name = document.createElement('div'); name.className = 'pname'; name.textContent = p.name || 'Bez nazwy';
    const sub = document.createElement('div'); sub.className = 'psub'; sub.textContent = p.pass ? 'z has≈Çem' : '';
    // edit small
    const edit = document.createElement('div'); edit.style.fontSize='12px'; edit.style.marginTop='8px'; edit.style.opacity=0.8; edit.textContent = 'Edytuj';
    edit.style.cursor = 'pointer';
    edit.onclick = (e) => { e.stopPropagation(); openEditProfile(p); };
    card.appendChild(av); card.appendChild(name); card.appendChild(sub); card.appendChild(edit);
    profilesEl.appendChild(card);
  });

  // show add card if allowed
  if (profiles.length < MAX_PROFILES){
    const add = document.createElement('div'); add.className = 'profile-card';
    add.onclick = openAddProfile;
    const plus = document.createElement('div'); plus.className = 'avatar add-avatar'; plus.textContent = '+';
    const txt = document.createElement('div'); txt.className = 'pname'; txt.textContent = 'Dodaj konto';
    add.appendChild(plus); add.appendChild(txt);
    profilesEl.appendChild(add);
  }
}

/* update footer info */
function updateProfilesInfo(){
  profilesInfo.textContent = `${profiles.length}/${MAX_PROFILES}`;
}

/* select profile (login simulation) */
function selectProfile(p){
  if (p.pass){
    const attempt = prompt(`To konto ma has≈Ço. Wpisz has≈Ço dla ${p.name}:`);
    if (attempt !== p.pass) return alert('B≈Çƒôdne has≈Ço');
  }
  // store currentProfile id in localStorage and go to app.html
  localStorage.setItem('currentProfile', p.id);
  // small animated "connecting" effect
  showConnectingAnimation(p);
}

/* connecting animation then redirect */
function showConnectingAnimation(profile){
  const overlay = document.createElement('div');
  overlay.style.position='fixed'; overlay.style.inset=0; overlay.style.background=`linear-gradient(180deg, ${profile.color||'#000'}, rgba(0,0,0,0.8))`; overlay.style.zIndex=9999;
  overlay.style.display='flex'; overlay.style.alignItems='center'; overlay.style.justifyContent='center'; overlay.style.flexDirection='column';
  overlay.innerHTML = `<div style="font-size:28px;font-weight:700;margin-bottom:12px">≈ÅƒÖczenie z profilem ${escapeHtml(profile.name)}</div>
    <div style="width:420px;height:12px;background:rgba(255,255,255,0.08);border-radius:12px;overflow:hidden">
      <div id="prog" style="width:0%;height:100%;background:linear-gradient(90deg,rgba(255,255,255,0.7),rgba(255,255,255,0.2));"></div>
    </div>
    <div style="margin-top:10px;color:rgba(255,255,255,0.9)">Przygotowujƒô interfejs i animacje...</div>`;
  document.body.appendChild(overlay);
  const prog = document.getElementById('prog');
  let w = 0;
  const steps = [40, 68, 92, 100];
  let i = 0;
  const t = setInterval(()=> {
    w += Math.random()*12;
    if (w >= steps[i]) { w = steps[i]; i++; }
    prog.style.width = Math.min(100,w) + '%';
    if (w >= 100) { clearInterval(t); setTimeout(()=> { location.href = 'app.html'; }, 700); }
  }, 300);
}

/* open add profile modal */
document.getElementById('btnAdd').addEventListener('click', openAddProfile);
function openAddProfile(){
  editingDocId = null;
  document.getElementById('modalTitle').textContent = 'Dodaj konto';
  document.getElementById('profileName').value = '';
  document.getElementById('profilePass').value = '';
  selectedIconIndex = Math.floor(Math.random()*ICONS.length);
  selectedColor = COLORS[0];
  renderAvatarChooser();
  renderColorGrid();
  profileModal.style.display = 'flex';
  document.body.style.overflow = 'hidden';
}

/* open edit profile modal */
function openEditProfile(profile){
  editingDocId = profile.id;
  document.getElementById('modalTitle').textContent = 'Edytuj konto';
  document.getElementById('profileName').value = profile.name || '';
  document.getElementById('profilePass').value = profile.pass || '';
  selectedIconIndex = ICONS.indexOf(profile.icon) >= 0 ? ICONS.indexOf(profile.icon) : 0;
  selectedColor = profile.color || COLORS[0];
  renderAvatarChooser();
  renderColorGrid();
  profileModal.style.display = 'flex';
  document.body.style.overflow = 'hidden';
}

/* close modal */
document.getElementById('cancelBtn').addEventListener('click', closeModal);
function closeModal(){ profileModal.style.display='none'; document.body.style.overflow=''; }

/* save profile -> Firestore */
document.getElementById('saveBtn').addEventListener('click', async () => {
  const name = document.getElementById('profileName').value.trim();
  const pass = document.getElementById('profilePass').value;
  if (!name) return alert('Wpisz nazwƒô profilu');
  // limit
  if (!editingDocId && profiles.length >= MAX_PROFILES) return alert('OsiƒÖgniƒôto maksymalnƒÖ liczbƒô profili');
  const payload = {
    name,
    pass: pass || '',
    icon: ICONS[selectedIconIndex],
    color: selectedColor,
    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
  };
  try{
    if (editingDocId){
      await db.collection('profiles').doc(editingDocId).set(payload, {merge:true});
    } else {
      payload.createdAt = firebase.firestore.FieldValue.serverTimestamp();
      await db.collection('profiles').add(payload);
    }
    // nice confetti-like micro animation
    confettiPulse();
    closeModal();
  }catch(err){
    console.error(err); alert('B≈ÇƒÖd zapisu: ' + err.message);
  }
});

/* avatar chooser render */
function renderAvatarChooser(){
  avatarEmoji.textContent = ICONS[selectedIconIndex];
  avatarPreview.style.background = `linear-gradient(135deg, ${selectedColor}20, #0b0b0b)`;
  avatarPreview.style.borderColor = selectedColor ? selectedColor + '88' : 'rgba(255,255,255,0.03)';
  iconList.innerHTML = '';
  ICONS.forEach((ic, i) => {
    const el = document.createElement('div'); el.className = 'icon-option'; el.textContent = ic;
    if (i === selectedIconIndex) el.classList.add('selected');
    el.onclick = () => { selectedIconIndex = i; renderAvatarChooser(); };
    iconList.appendChild(el);
  });
}

/* color grid */
function renderColorGrid(){
  colorGrid.innerHTML = '';
  COLORS.forEach(c => {
    const b = document.createElement('div'); b.className = 'color-box'; b.style.background = c; b.dataset.color = c;
    if (c === selectedColor) b.classList.add('selected');
    b.onclick = () => { selectedColor = c; renderColorGrid(); renderAvatarChooser(); };
    colorGrid.appendChild(b);
  });
}

/* carousel arrows */
document.getElementById('prevIcon').addEventListener('click', ()=> {
  selectedIconIndex = (selectedIconIndex - 1 + ICONS.length) % ICONS.length; renderAvatarChooser();
});
document.getElementById('nextIcon').addEventListener('click', ()=> {
  selectedIconIndex = (selectedIconIndex + 1) % ICONS.length; renderAvatarChooser();
});

/* confetti pulse */
function confettiPulse(){
  const el = document.createElement('div'); el.style.position='fixed'; el.style.inset=0; el.style.pointerEvents='none'; el.style.zIndex=9999;
  document.body.appendChild(el);
  for(let i=0;i<18;i++){
    const p = document.createElement('div'); p.textContent = ['üéâ','‚ú®','üí´','üéà'][Math.floor(Math.random()*4)];
    p.style.position='absolute'; p.style.left=(Math.random()*100)+'%'; p.style.top=(Math.random()*40)+'%';
    p.style.fontSize=(12+Math.random()*30)+'px'; p.style.opacity='0'; p.style.transition='all 1.1s cubic-bezier(.2,.9,.3,1)';
    el.appendChild(p);
    setTimeout(()=>{ p.style.opacity=1; p.style.transform=`translateY(${100+Math.random()*200}px) rotate(${Math.random()*600-300}deg)`; }, 30+i*20);
  }
  setTimeout(()=> el.remove(), 1300);
}

/* small helper to shade color */
function shadeColor(hex, percent){
  try{
    const h = hex.replace('#','');
    const R = parseInt(h.substring(0,2),16);
    const G = parseInt(h.substring(2,4),16);
    const B = parseInt(h.substring(4,6),16);
    const t=percent<0?0:255;
    const p=Math.abs(percent);
    const newR = Math.round((t - R)*p/100 + R);
    const newG = Math.round((t - G)*p/100 + G);
    const newB = Math.round((t - B)*p/100 + B);
    return `rgb(${newR},${newG},${newB})`;
  }catch(e){return hex;}
}

/* show existing profiles on load via Firestore realtime */
startRealtime();

/* keyboard: N add new */
document.addEventListener('keydown',(e)=>{ if (e.key.toLowerCase()==='n') openAddProfile(); });

/* small utility */
function escapeHtml(s=''){ return String(s).replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;'); }
</script>
</body>
</html>
